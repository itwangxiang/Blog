<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Android 开发大纲 - 须远</title><meta name=Description content><meta property="og:title" content="Android 开发大纲"><meta property="og:description" content="基础篇 四大组件 Activity
  生命周期
1 2 3 4 5 6  onCreate() onStart() onResume() onPause() onStop() onDestory()     启动模式
 standard singleTop singleTask singleInstance    Service
  startService
1 2 3 4  onCreate() onStartCommand() onStart() onDestroy()     bindService
1 2 3 4 5 6  bindService() onCreate() //IBinder onBind(Intent intent)() unBindService() onDestroy()     BroadcastReceiver
 作用：从 Android 系统和其他 Android 应用程序发送或接收广播消息 注册方式：静态/动态 类型  普通广播 Normal Broadcast 系统广播 System Broadcast 有序广播 Ordered Broadcast 粘性广播 Sticky Broadcast 应用内广播 Local Broadcast    Content Provider"><meta property="og:type" content="article"><meta property="og:url" content="https://wxiang.cc/android/"><meta property="og:image" content="https://wxiang.cc/logo.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-01-05T00:00:00+00:00"><meta property="article:modified_time" content="2022-01-09T18:06:48+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wxiang.cc/logo.jpg"><meta name=twitter:title content="Android 开发大纲"><meta name=twitter:description content="基础篇 四大组件 Activity
  生命周期
1 2 3 4 5 6  onCreate() onStart() onResume() onPause() onStop() onDestory()     启动模式
 standard singleTop singleTask singleInstance    Service
  startService
1 2 3 4  onCreate() onStartCommand() onStart() onDestroy()     bindService
1 2 3 4 5 6  bindService() onCreate() //IBinder onBind(Intent intent)() unBindService() onDestroy()     BroadcastReceiver
 作用：从 Android 系统和其他 Android 应用程序发送或接收广播消息 注册方式：静态/动态 类型  普通广播 Normal Broadcast 系统广播 System Broadcast 有序广播 Ordered Broadcast 粘性广播 Sticky Broadcast 应用内广播 Local Broadcast    Content Provider"><meta name=application-name content="须远"><meta name=apple-mobile-web-app-title content="须远"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://wxiang.cc/android/><link rel=prev href=https://wxiang.cc/java/><link rel=next href=https://wxiang.cc/eventbus/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Android 开发大纲","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wxiang.cc\/android\/"},"image":["https:\/\/wxiang.cc\/logo.jpg"],"genre":"posts","keywords":"大纲","wordcount":1194,"url":"https:\/\/wxiang.cc\/android\/","datePublished":"2017-01-05T00:00:00+00:00","dateModified":"2022-01-09T18:06:48+08:00","publisher":{"@type":"Organization","name":"须远","logo":"https:\/\/wxiang.cc\/images\/avatar.png"},"author":{"@type":"Person","name":"Kim Liss"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=须远>须远</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=须远>须远</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Android 开发大纲</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://wxiang.cc/about title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>Kim Liss</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E5%AE%89%E5%8D%93/><i class="far fa-folder fa-fw"></i>安卓</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2017-01-05>2017-01-05</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 1194 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;
&nbsp;|&nbsp;
<a href=https://github.com/itwangxiang/itwangxiang.github.io/tree/master/content/posts/android/android.md rel="noopener noreferrer" target=_blank>编辑</a></div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#基础篇>基础篇</a><ul><li><a href=#四大组件>四大组件</a></li><li><a href=#布局>布局</a></li><li><a href=#view>View</a></li><li><a href=#其他>其他</a></li></ul></li><li><a href=#原理篇>原理篇</a><ul><li><a href=#view-绘制>View 绘制</a></li><li><a href=#事件传递机制>事件传递机制</a></li><li><a href=#handler>Handler</a></li><li><a href=#asynctask>AsyncTask</a></li><li><a href=#activitythread>ActivityThread</a></li><li><a href=#内存泄露>内存泄露</a></li><li><a href=#内存溢出---oom>内存溢出 - OOM</a></li><li><a href=#threadlocal>ThreadLocal</a></li><li><a href=#lrucache-缓存策略>LruCache 缓存策略</a></li><li><a href=#屏幕刷新机制>屏幕刷新机制</a></li></ul></li><li><a href=#优化篇>优化篇</a></li><li><a href=#视频篇>视频篇</a><ul><li><a href=#关键术语和概念>关键术语和概念</a></li><li><a href=#解码>解码</a></li></ul></li><li><a href=#网络篇>网络篇</a></li><li><a href=#外设篇>外设篇</a><ul><li><a href=#低功耗蓝牙bluetooth-low-energyhttpsdeveloperandroidcomguidetopicsconnectivitybluetooth-le><a href=https://developer.android.com/guide/topics/connectivity/bluetooth-le>低功耗蓝牙(Bluetooth Low Energy)</a></a></li><li><a href=#串口通信>串口通信</a><ul><li><a href=#android-serialport-apihttpsgithubcomceprandroid-serialport-api><a href=https://github.com/cepr/android-serialport-api>android-serialport-api</a></a></li></ul></li></ul></li><li><a href=#开源篇>开源篇</a><ul><li><a href=#okhttp---官网httpsgithubcomsquareokhttp>OkHttp - <a href=https://github.com/square/okhttp>官网</a></a></li><li><a href=#retrofit---官网httpsgithubcomsquareretrofit>Retrofit - <a href=https://github.com/square/retrofit>官网</a></a></li><li><a href=#glide---官网httpsgithubcombumptechglide>Glide - <a href=https://github.com/bumptech/glide>官网</a></a></li><li><a href=#butterknife---官网httpsgithubcomjakewhartonbutterknife>ButterKnife - <a href=https://github.com/JakeWharton/butterknife>官网</a></a></li><li><a href=#rxjava---官网httpsgithubcomreactivexrxjava>Rxjava - <a href=https://github.com/ReactiveX/RxJava>官网</a></a></li><li><a href=#logger---官网httpsgithubcomorhanobutlogger>Logger - <a href=https://github.com/orhanobut/logger>官网</a></a></li><li><a href=#eventbus---官网httpsgithubcomgreenroboteventbus>EventBus - <a href=https://github.com/greenrobot/EventBus>官网</a></a></li><li><a href=#多渠道打包>多渠道打包</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=基础篇>基础篇</h2><h3 id=四大组件>四大组件</h3><p>Activity</p><ul><li><p><a href=https://developer.android.com/guide/components/activities/activity-lifecycle#java target=_blank rel="noopener noreffer">生命周期</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>onCreate</span><span class=o>()</span>
<span class=n>onStart</span><span class=o>()</span>
<span class=n>onResume</span><span class=o>()</span>
<span class=n>onPause</span><span class=o>()</span>
<span class=n>onStop</span><span class=o>()</span>
<span class=n>onDestory</span><span class=o>()</span>
</code></pre></td></tr></table></div></div></li><li><p><a href=https://developer.android.com/guide/components/activities/tasks-and-back-stack#TaskLaunchModes target=_blank rel="noopener noreffer">启动模式</a></p><ul><li>standard</li><li>singleTop</li><li>singleTask</li><li>singleInstance</li></ul></li></ul><p>Service</p><ul><li><p>startService</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>onCreate</span><span class=o>()</span>
<span class=n>onStartCommand</span><span class=o>()</span>
<span class=n>onStart</span><span class=o>()</span>
<span class=n>onDestroy</span><span class=o>()</span>
</code></pre></td></tr></table></div></div></li><li><p>bindService</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>bindService</span><span class=o>()</span>
<span class=n>onCreate</span><span class=o>()</span>
<span class=c1>//IBinder
</span><span class=c1></span><span class=n>onBind</span><span class=o>(</span><span class=n>Intent</span> <span class=n>intent</span><span class=o>)()</span>
<span class=n>unBindService</span><span class=o>()</span>
<span class=n>onDestroy</span><span class=o>()</span>
</code></pre></td></tr></table></div></div></li></ul><p>BroadcastReceiver</p><ul><li>作用：从 Android 系统和其他 Android 应用程序发送或接收广播消息</li><li>注册方式：静态/动态</li><li>类型<ul><li>普通广播 <code>Normal Broadcast</code></li><li>系统广播 <code>System Broadcast</code></li><li>有序广播 <code>Ordered Broadcast</code></li><li>粘性广播 <code>Sticky Broadcast</code></li><li>应用内广播 <code>Local Broadcast</code></li></ul></li></ul><p>Content Provider</p><h3 id=布局>布局</h3><ul><li>LinearLayout</li><li>RelativeLayout</li><li>FrameLayout</li><li>TableLayout</li></ul><h3 id=view>View</h3><ul><li><code>SurfaceView</code><ul><li>双缓冲机制</li><li>子线程绘制</li></ul></li><li><code>TextureView</code><ul><li>TextureView可用于显示内容流。</li><li>例如，这样的内容流可以是视频或OpenGL场景。</li><li>内容流可以来自应用程序的进程，也可以来自远程进程</li></ul></li><li><code>VideoView</code></li><li><code>WebView</code></li></ul><h3 id=其他>其他</h3><ul><li>AlertDialog,popupWindow,Activity 的区别</li><li>Application 和 Activity 的 Context 对象的区别</li><li>BroadcastReceiver，LocalBroadcastReceiver 的区别</li></ul><h2 id=原理篇>原理篇</h2><h3 id=view-绘制>View 绘制</h3><ul><li>measure<ul><li>MeasureSpec<ul><li><code>UNSPECIFIED</code> - 未明确模式</li><li><code>EXACTLY</code> - 精确模式</li><li><code>AT_MOST</code> - 最多模式</li></ul></li></ul></li><li>layout</li><li>draw<ul><li><code>onDraw(Canvas canvas)</code></li></ul></li></ul><h3 id=事件传递机制>事件传递机制</h3><ul><li>ViewGroup<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>dispatchTouchEvent</span><span class=o>()</span>
<span class=n>onInterceptTouchEvent</span><span class=o>()</span> <span class=o>==</span> <span class=kc>true</span>
<span class=n>onTouchListener</span><span class=o>.</span><span class=na>onTouch</span><span class=o>()</span>
<span class=n>onTouchEvent</span><span class=o>()</span>
<span class=n>onClick</span><span class=o>()</span>
</code></pre></td></tr></table></div></div></li><li>View<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>dispatchTouchEvent</span><span class=o>()</span>
<span class=n>onTouchListener</span><span class=o>.</span><span class=na>onTouch</span><span class=o>()</span>
<span class=n>onTouchEvent</span><span class=o>()</span>
<span class=n>onClick</span><span class=o>()</span>
</code></pre></td></tr></table></div></div></li><li>View 滑动冲突<ul><li><p>外部拦截法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onInterceptTouchEvent</span><span class=o>(</span><span class=n>MotionEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
    <span class=kt>boolean</span> <span class=n>intercepted</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
    <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span> <span class=n>event</span><span class=o>.</span><span class=na>getX</span><span class=o>();</span>
    <span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span> <span class=n>event</span><span class=o>.</span><span class=na>getY</span><span class=o>();</span>
    <span class=k>switch</span> <span class=o>(</span><span class=n>event</span><span class=o>.</span><span class=na>getAction</span><span class=o>())</span> <span class=o>{</span>
        <span class=k>case</span> <span class=n>MotionEvent</span><span class=o>.</span><span class=na>ACTION_DOWN</span><span class=o>:</span> <span class=o>{</span>
            <span class=n>intercepted</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
            <span class=k>break</span><span class=o>;</span>
        <span class=o>}</span>
        <span class=k>case</span> <span class=n>MotionEvent</span><span class=o>.</span><span class=na>ACTION_MOVE</span><span class=o>:</span> <span class=o>{</span>
            <span class=k>if</span> <span class=o>(</span><span class=n>满足父容器的拦截要求</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>intercepted</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
            <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
                <span class=n>intercepted</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
            <span class=o>}</span>
            <span class=k>break</span><span class=o>;</span>
        <span class=o>}</span>
        <span class=k>case</span> <span class=n>MotionEvent</span><span class=o>.</span><span class=na>ACTION_UP</span><span class=o>:</span> <span class=o>{</span>
            <span class=n>intercepted</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
            <span class=k>break</span><span class=o>;</span>
        <span class=o>}</span>
        <span class=k>default</span><span class=o>:</span>
            <span class=k>break</span><span class=o>;</span>
    <span class=o>}</span>
    <span class=n>mLastXIntercept</span> <span class=o>=</span> <span class=n>x</span><span class=o>;</span>
    <span class=n>mLastYIntercept</span> <span class=o>=</span> <span class=n>y</span><span class=o>;</span>
    <span class=k>return</span> <span class=n>intercepted</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div></li><li><p>内部拦截法</p><ul><li><p>示例</p><ul><li><p>子 View</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>dispatchTouchEvent</span><span class=o>(</span><span class=n>MotionEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
    <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span> <span class=n>event</span><span class=o>.</span><span class=na>getX</span><span class=o>();</span>
    <span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span> <span class=n>event</span><span class=o>.</span><span class=na>getY</span><span class=o>();</span>

    <span class=k>switch</span> <span class=o>(</span><span class=n>event</span><span class=o>.</span><span class=na>getAction</span><span class=o>())</span> <span class=o>{</span>
        <span class=k>case</span> <span class=n>MotionEvent</span><span class=o>.</span><span class=na>ACTION_DOWN</span><span class=o>:</span> <span class=o>{</span>
            <span class=n>parent</span><span class=o>.</span><span class=na>requestDisallowInterceptTouchEvent</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
            <span class=k>break</span><span class=o>;</span>
        <span class=o>}</span>
        <span class=k>case</span> <span class=n>MotionEvent</span><span class=o>.</span><span class=na>ACTION_MOVE</span><span class=o>:</span> <span class=o>{</span>
            <span class=kt>int</span> <span class=n>deltaX</span> <span class=o>=</span> <span class=n>x</span> <span class=o>-</span> <span class=n>mLastX</span><span class=o>;</span>
            <span class=kt>int</span> <span class=n>deltaY</span> <span class=o>=</span> <span class=n>y</span> <span class=o>-</span> <span class=n>mLastY</span><span class=o>;</span>
            <span class=k>if</span> <span class=o>(</span><span class=n>父容器需要此类点击事件</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>parent</span><span class=o>.</span><span class=na>requestDisallowInterceptTouchEvent</span><span class=o>(</span><span class=kc>false</span><span class=o>);</span>
            <span class=o>}</span>
            <span class=k>break</span><span class=o>;</span>
        <span class=o>}</span>
        <span class=k>case</span> <span class=n>MotionEvent</span><span class=o>.</span><span class=na>ACTION_UP</span><span class=o>:</span> <span class=o>{</span>
            <span class=k>break</span><span class=o>;</span>
        <span class=o>}</span>
        <span class=k>default</span><span class=o>:</span>
            <span class=k>break</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=n>mLastX</span> <span class=o>=</span> <span class=n>x</span><span class=o>;</span>
    <span class=n>mLastY</span> <span class=o>=</span> <span class=n>y</span><span class=o>;</span>
    <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>dispatchTouchEvent</span><span class=o>(</span><span class=n>event</span><span class=o>);</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div></li><li><p>父 View</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onInterceptTouchEvent</span><span class=o>(</span><span class=n>MotionEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
    <span class=kt>int</span> <span class=n>action</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=na>getAction</span><span class=o>();</span>
    <span class=k>if</span> <span class=o>(</span><span class=n>action</span> <span class=o>==</span> <span class=n>MotionEvent</span><span class=o>.</span><span class=na>ACTION_DOWN</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div></li></ul></li><li><p>注意点：</p><ul><li>内部拦截法要求父View不能拦截ACTION_DOWN事件，由于ACTION_DOWN不受FLAG_DISALLOW_INTERCEPT标志位控制，一旦父容器拦截ACTION_DOWN那么所有的事件都不会传递给子View。</li><li>滑动策略的逻辑放在子View的dispatchTouchEvent方法的ACTION_MOVE中，如果父容器需要获取点击事件则调用 parent.requestDisallowInterceptTouchEvent(false)方法，让父容器去拦截事件。</li></ul></li></ul></li></ul></li></ul><h3 id=handler>Handler</h3><p><em><strong><code>post</code> 流程</strong></em></p><ul><li>等待消息：Looper.loop();</li><li>消息入队：<ol><li>Handler.sendMessage(msg)</li><li>Looper.MessageQueue.enqueueMessage(msg)</li></ol></li><li>处理消息：Looper.loop();<ol><li>循环 MessageQueue.next()</li><li>调用 <code>msg.target.dispatchMessage(msg)</code></li></ol></li><li>消息出队：<ol><li>Handler.dispatchMessage(msg)</li><li>Handler.handleMessage(msg)</li></ol></li></ul><p><em><strong><code>postDelayed</code> 流程</strong></em></p><ul><li>消息是通过 <code>MessageQueen</code> 中的 <code>enqueueMessage</code>()方法加入消息队列中的，并且它在放入中就进行好排序，链表头的延迟时间小，尾部延迟时间最大</li><li><code>Looper.loop()</code> 通过 <code>MessageQueue</code> 中的 <code>next()</code> 去取消息</li><li><code>next()</code> 中如果当前链表头部消息是延迟消息，则根据延迟时间进行消息队列会阻塞，不返回给 <code>Looper message</code>，知道时间到了，返回给 <code>message</code></li><li>如果在阻塞中有新的消息插入到链表头部则唤醒线程</li><li><code>Looper</code> 将新消息交给回调给 <code>handler</code> 中的 <code>handleMessage</code> 后，继续调用 <code>MessageQueen</code> 的 <code>next()</code> 方法，如果刚刚的延迟消息还是时间未到，则计算时间继续阻塞</li></ul><h3 id=asynctask>AsyncTask</h3><blockquote><p><a href=https://developer.android.com/reference/android/os/AsyncTask target=_blank rel="noopener noreffer">官网</a></p></blockquote><p><code>AsyncTask</code> 可以正确，方便地使用 UI 线程。此类允许您执行后台操作并在 UI 线程上发布结果，而无需操作线程和/或处理程序</p><h3 id=activitythread>ActivityThread</h3><p>它管理应用程序进程中主线程的执行，按照活动管理器的请求调度和执行活动、广播和其他操作</p><ol><li>LauncherActivity 通过 Binder 进程间通信的方式将应用的信息通过 Intent 的方式传递给 AMS ，由 AMS 进行调度。</li><li>如果系统中不存在该进程时，AMS 将会请求 Zygote 服务去 fork 一个子进程，成功后返回一个 pid 给 AMS，并由 AndroidRuntime 机制调起 ActivityThread 中的 main() 方法。</li><li>紧接着，应用程序的 Main Looper 被创建，ActivityThread 被实例化成为对象并将 Application 的信息以进程间通信的方式再次回馈给 AMS。</li><li>AMS 接收到客户端发来的请求数据之后，首先将应用程序绑定，并启动应用程序的 Activity，开始执行 Activity 的生命周期</li></ol><h3 id=内存泄露>内存泄露</h3><ul><li>场景<ul><li>单例</li><li>匿名内部类</li><li>Context</li><li>Handler</li><li>Cursor，Stream</li><li>WebView</li></ul></li><li>排查工具<ul><li><p>dumpsys</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>adb shell dumpsys meminfo &lt;packageName&gt;
</code></pre></td></tr></table></div></div></li><li><p>LeakCanary</p></li></ul></li></ul><h3 id=内存溢出---oom>内存溢出 - OOM</h3><ul><li>原因<ul><li>内存泄露</li><li>内存占用过多的对象</li></ul></li></ul><h3 id=threadlocal>ThreadLocal</h3><h3 id=lrucache-缓存策略>LruCache 缓存策略</h3><blockquote><p>包含对有限数量值的强引用的缓存。每次访问一个值时，它都会移动到队列的头部。将值添加到完整缓存时，该队列末尾的值将被逐出，并且可能符合垃圾回收的条件</p></blockquote><ul><li>原理：<ul><li><code>LruCache</code> 中维护了一个 <code>LinkedHashMap</code> 集合并将其设置顺序排序。</li><li>当调用 <code>put()</code> 方法时，就会在集合中添加元素，并调用 <code>trimToSize()</code> 判断缓存是否已满，如果满了就用 <code>LinkedHashMap</code> 的迭代器删除队尾元素，即近期最少访问的元素。</li><li>当调用 <code>get()</code> 方法访问缓存对象时，就会调用 <code>LinkedHashMap</code> 的 <code>get()</code> 方法获得对应集合元素，同时会更新该元素到队头</li></ul></li></ul><h3 id=屏幕刷新机制>屏幕刷新机制</h3><ul><li>Android 应用程序调用 SurfaceFlinger 服务把经过测量、布局和绘制后的 Surface 渲染到显示屏幕上</li></ul><blockquote><p>参考资料</p></blockquote><ul><li><a href=http://djt.qq.com/article/view/987 target=_blank rel="noopener noreffer">Android 显示原理简介</a></li></ul><h2 id=优化篇>优化篇</h2><ul><li>内存优化</li><li>UI 优化</li><li>网络优化</li><li>启动优化</li><li>电量优化</li></ul><blockquote><p>参考资料</p></blockquote><ul><li><a href=https://juejin.im/post/5a0d30e151882546d71ee49e#heading-17 target=_blank rel="noopener noreffer">Android 性能优化全方面解析</a></li></ul><h2 id=视频篇>视频篇</h2><h3 id=关键术语和概念>关键术语和概念</h3><ul><li><code>视频</code> - 泛指将一系列的静态影像以电信号方式加以捕捉、纪录、处理、存储、发送与重现的各种技术</li><li><code>帧率</code> - 用于测量显示帧数的量度<ul><li>单位：<ul><li>FPS（每秒显示帧数） - 一般来说 FPS 用于描述影片、电子绘图或游戏每秒播放多少帧</li><li>Hz（赫兹） - 每一秒周期性事件发生的次数</li></ul></li><li>视觉暂留 - 如果所看画面之帧率高于每秒约10至12帧的时候，就会认为是连贯的</li></ul></li><li><code>长宽比</code> - 是用来描述影音画面与画面元素的比例<ul><li>常见的比例 - 4:3 / 16:9</li></ul></li><li><code>封装格式</code> - 压缩过的视频数据和音频数据打包成一个文件的规范<ul><li>AVI、RMVB、MKV、ASF、WMV、MP4、3GP、FLV</li></ul></li><li><code>编解码</code><ul><li>编码 - 对视频进行压缩<ul><li>视频编码格式 - <code>H264</code>、<code>Xvid</code></li><li>音频编码格式 - <code>MP3</code>、<code>AAC</code></li></ul></li><li>解码 - 对视频进行解压缩</li></ul></li><li><code>音画同步</code><ul><li>将视频同步到音频上</li><li>将音频同步到视频上</li><li>将视频和音频同步外部的时钟上</li></ul></li><li><code>RTC</code> - 实时通信<ul><li>采集</li><li>前处理</li><li>编码</li><li>传输</li><li>解码</li><li>后处理</li><li>缓冲</li><li>渲染</li></ul></li></ul><h3 id=解码>解码</h3><ul><li>硬解 - 硬件解码是图形芯片厂商提出的用GPU资源解码视频流的方案<ul><li><code>MediaPlayer</code><ul><li>代表播放器 - Android 自带的 <a href=https://developer.android.com/reference/android/widget/VideoView target=_blank rel="noopener noreffer">VideoView</a></li></ul></li><li><code>MediaCodec</code><ul><li>代表播放器 - Google 的 <a href=https://github.com/google/ExoPlayer target=_blank rel="noopener noreffer">ExoPlayer</a></li></ul></li></ul></li><li>软解 - 相对于硬件解码，传统的软件解码是用CPU承担解码工作<ul><li><code>FFmpeg</code><ul><li>代表播放器 - Bilibili 的 <a href=https://github.com/Bilibili/ijkplayer target=_blank rel="noopener noreffer">ijkplayer</a></li></ul></li></ul></li></ul><h2 id=网络篇>网络篇</h2><h2 id=外设篇>外设篇</h2><h3 id=低功耗蓝牙bluetooth-low-energyhttpsdeveloperandroidcomguidetopicsconnectivitybluetooth-le><a href=https://developer.android.com/guide/topics/connectivity/bluetooth-le target=_blank rel="noopener noreffer">低功耗蓝牙(Bluetooth Low Energy)</a></h3><ul><li>关键术语和概念<ul><li>通用属性配置文件 <code>Generic Attribute Profile</code> (GATT) - GATT 配置文件是一种通用规范，内容针对在 BLE 链路上发送和接收称为“属性”的简短数据片段</li><li>属性协议 <code>Attribute Protocol</code> (ATT) — 属性协议 (ATT) 是 GATT 的构建基础，二者的关系也被称为 GATT/ATT</li><li>特征 <code>Characteristic</code> — 特征包含一个值和 0 至 n 个描述特征值的描述符</li><li>描述符 <code>Descriptor</code> — 描述符是描述特征值的已定义属性</li><li>服务 <code>Service</code> - 服务是一系列特征</li></ul></li><li>使用流程<ul><li><p>设置 <code>BLE</code></p><ul><li><p>获取 <code>BluetoothAdapter</code></p></li><li><p>启用蓝牙</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>val</span> <span class=py>enableBtIntent</span> <span class=p>=</span> <span class=n>Intent</span><span class=p>(</span><span class=n>BluetoothAdapter</span><span class=p>.</span><span class=n>ACTION_REQUEST_ENABLE</span><span class=p>)</span>
<span class=n>startActivityForResult</span><span class=p>(</span><span class=n>enableBtIntent</span><span class=p>,</span> <span class=n>REQUEST_ENABLE_BT</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></li></ul></li><li><p>查找 <code>BLE</code> 设备</p><ul><li><p>方法</p><ul><li><code>startLeScan(BluetoothAdapter.LeScanCallback)</code> - 查找 BLE 设备</li><li><code>startLeScan(UUID[], BluetoothAdapter.LeScanCallback)</code> - 扫描特定类型的外围设备</li></ul></li><li><p>注意事项(由于扫描非常耗电)</p><ul><li>找到所需设备后，立即停止扫描</li><li>绝对不进行循环扫描，并设置扫描时间限制</li></ul></li><li><p>Code</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>private</span> <span class=k>var</span> <span class=py>mScanning</span><span class=p>:</span> <span class=n>Boolean</span> <span class=p>=</span> <span class=k>false</span>

<span class=c1>//返回扫描结果
</span><span class=c1></span><span class=k>private</span> <span class=k>val</span> <span class=py>leScanCallback</span> <span class=p>=</span> <span class=n>BluetoothAdapter</span><span class=p>.</span><span class=n>LeScanCallback</span> <span class=p>{</span> <span class=n>device</span><span class=p>,</span> <span class=n>rssi</span><span class=p>,</span> <span class=n>scanRecord</span> <span class=o>-&gt;</span>
    <span class=n>runOnUiThread</span> <span class=p>{</span>
        <span class=c1>//todo
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>//在预定义的扫描时间段后停止扫描
</span><span class=c1></span><span class=n>handler</span><span class=p>.</span><span class=n>postDelayed</span><span class=p>({</span>
    <span class=n>mScanning</span> <span class=p>=</span> <span class=k>false</span>
    <span class=n>bluetoothAdapter</span><span class=p>.</span><span class=n>stopLeScan</span><span class=p>(</span><span class=n>leScanCallback</span><span class=p>)</span>
<span class=p>},</span> <span class=m>10000</span><span class=p>)</span>
<span class=n>mScanning</span> <span class=p>=</span> <span class=k>true</span>
<span class=n>bluetoothAdapter</span><span class=p>.</span><span class=n>startLeScan</span><span class=p>(</span><span class=n>leScanCallback</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></li></ul></li><li><p>连接 GATT 服务器</p><ul><li><p>方法 <code>BluetoothGatt connectGatt (Context context, boolean autoConnect, BluetoothGattCallback callback)</code></p></li><li><p>Code</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>private</span> <span class=k>val</span> <span class=py>gattCallback</span> <span class=p>=</span> <span class=k>object</span> <span class=err>: </span><span class=nc>BluetoothGattCallback</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onConnectionStateChange</span><span class=p>(</span>
            <span class=n>gatt</span><span class=p>:</span> <span class=n>BluetoothGatt</span><span class=p>,</span>
            <span class=n>status</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span>
            <span class=n>newState</span><span class=p>:</span> <span class=n>Int</span>
    <span class=p>)</span> <span class=p>{</span>

    <span class=p>}</span>

    <span class=c1>// New services discovered
</span><span class=c1></span>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onServicesDiscovered</span><span class=p>(</span><span class=n>gatt</span><span class=p>:</span> <span class=n>BluetoothGatt</span><span class=p>,</span> <span class=n>status</span><span class=p>:</span> <span class=n>Int</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>when</span> <span class=p>(</span><span class=n>status</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>BluetoothGatt</span><span class=p>.</span><span class=n>GATT_SUCCESS</span> <span class=o>-&gt;</span> <span class=n>broadcastUpdate</span><span class=p>(</span><span class=n>ACTION_GATT_SERVICES_DISCOVERED</span><span class=p>)</span>
            <span class=k>else</span> <span class=o>-&gt;</span> <span class=n>Log</span><span class=p>.</span><span class=n>w</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s2>&#34;onServicesDiscovered received: </span><span class=si>$status</span><span class=s2>&#34;</span><span class=p>)</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// Result of a characteristic read operation
</span><span class=c1></span>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onCharacteristicRead</span><span class=p>(</span>
            <span class=n>gatt</span><span class=p>:</span> <span class=n>BluetoothGatt</span><span class=p>,</span>
            <span class=n>characteristic</span><span class=p>:</span> <span class=n>BluetoothGattCharacteristic</span><span class=p>,</span>
            <span class=n>status</span><span class=p>:</span> <span class=n>Int</span>
    <span class=p>)</span> <span class=p>{</span>
        <span class=k>when</span> <span class=p>(</span><span class=n>status</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>BluetoothGatt</span><span class=p>.</span><span class=n>GATT_SUCCESS</span> <span class=o>-&gt;</span> <span class=p>{</span>
                    <span class=n>broadcastUpdate</span><span class=p>(</span><span class=n>ACTION_DATA_AVAILABLE</span><span class=p>,</span> <span class=n>characteristic</span><span class=p>)</span>
                <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// Characteristic notification
</span><span class=c1></span>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onCharacteristicChanged</span><span class=p>(</span>
            <span class=n>gatt</span><span class=p>:</span> <span class=n>BluetoothGatt</span><span class=p>,</span>
            <span class=n>characteristic</span><span class=p>:</span> <span class=n>BluetoothGattCharacteristic</span>
    <span class=p>)</span> <span class=p>{</span>
        <span class=n>broadcastUpdate</span><span class=p>(</span><span class=n>ACTION_DATA_AVAILABLE</span><span class=p>,</span> <span class=n>characteristic</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></li></ul></li><li><p>读取 BLE 属性</p></li><li><p>接收 GATT 通知 - <code>setCharacteristicNotification()</code></p></li><li><p>关闭客户端应用 - <code>close()</code></p></li></ul></li></ul><h3 id=串口通信>串口通信</h3><h4 id=android-serialport-apihttpsgithubcomceprandroid-serialport-api><a href=https://github.com/cepr/android-serialport-api target=_blank rel="noopener noreffer">android-serialport-api</a></h4><ul><li><p><code>SerialPort</code> - 获取串口的类(其实就是获取输入输出流)</p><ul><li><p><code>public SerialPort(File device, int baudrate, int flags)</code></p><ul><li>参数<ul><li><code>device</code> - 要操作的文件对象</li><li><code>baudrate</code> - 波特率</li><li><code>flags</code> - 文件操作的标志</li></ul></li><li>流程<ul><li>JNI - <code>FileDescriptor open(String path, int baudrate, int flags)</code></li><li>C - <code>int open(const char * pathname, int flags)</code><ul><li><code>pathname</code> - 指向欲打开的文件路径字符串</li><li><code>flags</code> - 文件的打开打开方式: O_RDONLY 以只读方式打开文件O_WRONLY 以只写方式打开文件O_RDWR 以可读写方式打开文件</li><li><code>return</code> 若所有欲核查的权限都通过了检查则返回0 值, 表示成功, 只要有一个权限被禁止则返回-1</li></ul></li></ul></li></ul></li><li><p>读数据 - <code>getInputStream()</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>class</span> <span class=nc>ReadThread</span> <span class=kd>extends</span> <span class=n>Thread</span> <span class=o>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
        <span class=kd>super</span><span class=o>.</span><span class=na>run</span><span class=o>();</span>
        <span class=k>while</span><span class=o>(!</span><span class=n>isInterrupted</span><span class=o>())</span> <span class=o>{</span>
            <span class=kt>int</span> <span class=n>size</span><span class=o>;</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=kt>byte</span><span class=o>[]</span> <span class=n>buffer</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>byte</span><span class=o>[</span><span class=n>64</span><span class=o>];</span>
                <span class=k>if</span> <span class=o>(</span><span class=n>getInputStream</span><span class=o>()</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=k>return</span><span class=o>;</span>
                <span class=n>size</span> <span class=o>=</span> <span class=n>getInputStream</span><span class=o>().</span><span class=na>read</span><span class=o>(</span><span class=n>buffer</span><span class=o>);</span>
                <span class=k>if</span> <span class=o>(</span><span class=n>size</span> <span class=o>&gt;</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>onDataReceived</span><span class=o>(</span><span class=n>buffer</span><span class=o>,</span> <span class=n>size</span><span class=o>);</span>
                <span class=o>}</span>
            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
                <span class=k>return</span><span class=o>;</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div></li><li><p>写数据 - <code>getOutputStream()</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>String</span> <span class=n>commandStr</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
<span class=n>FileOutputStream</span> <span class=n>mOutputStream</span> <span class=o>=</span> <span class=n>getOutputStream</span><span class=o>();</span>
<span class=kt>byte</span><span class=o>[]</span> <span class=n>text</span> <span class=o>=</span> <span class=n>StringUtils</span><span class=o>.</span><span class=na>hexStringToBytes</span><span class=o>(</span><span class=n>commandStr</span><span class=o>);</span>
<span class=k>try</span> <span class=o>{</span>
    <span class=n>mOutputStream</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>text</span><span class=o>);</span>
    <span class=n>mOutputStream</span><span class=o>.</span><span class=na>flush</span><span class=o>();</span>
<span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
    <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div></li></ul></li><li><p><code>SerialPortFinder</code> - 获取硬件地址的类</p></li><li><p>常见问题</p><ul><li>包名 - <code>android_serialport_api</code></li><li>写入权限时，<code>/system/xbin/su</code> or <code>/system/bin/su</code></li><li>设备需要 Root 权限</li></ul></li></ul><h2 id=开源篇>开源篇</h2><h3 id=okhttp---官网httpsgithubcomsquareokhttp>OkHttp - <a href=https://github.com/square/okhttp target=_blank rel="noopener noreffer">官网</a></h3><blockquote><p>适用于 Android 和 Java 应用程序的 HTTP + HTTP/2 客户端</p></blockquote><ul><li>OkHttp 支持同步调用和异步调用</li><li>OkHttp 提供了对最新的 HTTP 协议版本 HTTP/2 和 SPDY 的支持，这使得对同一个主机发出的所有请求都可以共享相同的套接字连接</li><li>如果 HTTP/2 和 SPDY 不可用，OkHttp 会使用连接池来复用连接以提高效率</li><li>OkHttp 提供了对 GZIP 的默认支持来降低传输内容的大小</li><li>OkHttp 也提供了对 HTTP 响应的缓存机制，可以避免不必要的网络请求</li><li>当网络出现问题时，OkHttp 会自动重试一个主机的多个 IP 地址</li></ul><h3 id=retrofit---官网httpsgithubcomsquareretrofit>Retrofit - <a href=https://github.com/square/retrofit target=_blank rel="noopener noreffer">官网</a></h3><blockquote><p>适用于 Android 和 Java 的类型安全的 HTTP 客户端</p></blockquote><ul><li>默认基于 OkHttp 封装的一套 RESTful 网络请求框架</li><li>通过注解直接配置请求</li><li>使用不同 Json Converter 来序列化数据</li><li>提供对 RxJava 的支持</li></ul><h3 id=glide---官网httpsgithubcombumptechglide>Glide - <a href=https://github.com/bumptech/glide target=_blank rel="noopener noreffer">官网</a></h3><blockquote><p>Glide 是一个快速高效的 Android 图片加载库，注重于平滑的滚动</p></blockquote><ul><li>Glide 支持拉取，解码和展示视频快照，图片，和 GIF 动画</li><li>Glide 使用简明的流式语法 API</li></ul><h3 id=butterknife---官网httpsgithubcomjakewhartonbutterknife>ButterKnife - <a href=https://github.com/JakeWharton/butterknife target=_blank rel="noopener noreffer">官网</a></h3><blockquote><p>将 Android 视图和回调绑定到字段和方法</p></blockquote><ul><li>通过在字段上使用 <code>@BindView</code> 消除 <code>findViewById</code> 回调</li><li>在列表或数组中组合多个视图。一次性使用操作，设置器或属性操作它们</li><li>通过使用<code>@OnClick</code>和其他方法注释方法来消除侦听器的匿名内部类</li><li>通过在字段上使用资源注释来消除资源查找</li></ul><h3 id=rxjava---官网httpsgithubcomreactivexrxjava>Rxjava - <a href=https://github.com/ReactiveX/RxJava target=_blank rel="noopener noreffer">官网</a></h3><blockquote><p>RxJava - JVM 的 Reactive Extensions - 一个使用 Java VM 的可观察序列组成异步和基于事件的程序的库</p></blockquote><ul><li>基于事件流的链式调用、逻辑简洁 & 使用简单</li><li>扩展了观察者模式，以支持数据/事件序列，并增加了操作符，他可以将将序列清晰的组合在一起的</li></ul><h3 id=logger---官网httpsgithubcomorhanobutlogger>Logger - <a href=https://github.com/orhanobut/logger target=_blank rel="noopener noreffer">官网</a></h3><blockquote><p>简单，漂亮，功能强大的 android 记录器</p></blockquote><h3 id=eventbus---官网httpsgithubcomgreenroboteventbus>EventBus - <a href=https://github.com/greenrobot/EventBus target=_blank rel="noopener noreffer">官网</a></h3><ul><li><a href=development/android/EventBus.md rel>源码分析</a></li></ul><blockquote><p>适用于 Android 和 Java 的事件总线，可简化 Activities, Fragments, Threads, Services 等之间的通信。减少代码，提高质量</p></blockquote><h3 id=多渠道打包>多渠道打包</h3><ul><li><a href=https://github.com/GavinCT/AndroidMultiChannelBuildTool target=_blank rel="noopener noreffer">AndroidMultiChannelBuildTool</a></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-01-09&nbsp;<a class=git-hash href=https://github.com/itwangxiang/itwangxiang.github.io/commit/542cc7efe6f10a91d31224e777e0844267d4ab6e target=_blank title="commit by itwangxiang(itwangxiang@foxmail.com) 542cc7efe6f10a91d31224e777e0844267d4ab6e: chore: edit">
<i class="fas fa-hashtag fa-fw"></i>542cc7e</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/android/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://wxiang.cc/android/ data-title="Android 开发大纲" data-hashtags=大纲><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://wxiang.cc/android/ data-hashtag=大纲><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://wxiang.cc/android/ data-title="Android 开发大纲"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://wxiang.cc/android/ data-title="Android 开发大纲"><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/%E5%A4%A7%E7%BA%B2/>大纲</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/java/ class=prev rel=prev title="Java 开发大纲"><i class="fas fa-angle-left fa-fw"></i>Java 开发大纲</a>
<a href=/eventbus/ class=next rel=next title="EventBus 源码分析">EventBus 源码分析<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>wxiang.cc</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2015 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://wxiang.cc/about target=_blank>Kim Liss</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=https://wxiang.disqus.com/embed.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>